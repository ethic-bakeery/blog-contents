---
title: Pyramid Of Pain
description: Learn what is the Pyramid of Pain and how to utilize this model to determine the level of difficulty it will cause for an adversary to change the indicators associated with them, and their campaign.
pubDate: 12 01 2024
image: /tryhackme/SOC1/Section1/index01.png
categories:
  - SOC level 1
tags:
  - Defense Frameworks
---
import Info from "../../components/blog/info.astro";

## Introduction 

## The Pyramid of Pain in Cybersecurity

The **Pyramid of Pain** is a well-known concept used to understand the challenges faced during cyber threat intelligence (CTI), threat hunting, and incident response. This model helps professionals prioritize the most effective indicators of compromise (IOCs) when hunting for threats or responding to incidents. 

As a **Threat Hunter**, **Incident Responder**, or **SOC Analyst**, applying this model can improve the detection and mitigation of cyber threats. The concept categorizes IOCs into various levels of pain, from low-level items like file hashes to high-level items like tactics, techniques, and procedures (TTPs). The higher the level of the pyramid, the more pain it causes for adversaries when targeted.

This concept is being applied to a variety of cybersecurity solutions to enhance their effectiveness:

- **Cisco Security**: The Pyramid of Pain is used in their **Cyber Threat Intelligence (CTI)** framework to improve the detection of attacks by focusing on more significant and impactful indicators. Learn more on [Cisco's blog](https://gblogs.cisco.com/ca/2020/08/26/the-canadian-bacon-cisco-security-and-the-pyramid-of-pain/).
  
- **SentinelOne**: SentinelOne leverages the Pyramid of Pain model in their **Endpoint Detection and Response (EDR)** solutions to strengthen cyber threat intelligence and improve response times. Check out more on [SentinelOne’s blog](https://www.sentinelone.com/blog/revisiting-the-pyramid-of-pain-leveraging-edr-data-to-improve-cyber-threat-intelligence/).

- **SOCRadar**: SOCRadar focuses on effectively using the Pyramid of Pain concept to enhance the application of **Cyber Threat Intelligence (CTI)**, improving incident detection and response capabilities. Learn more on [SOCRadar’s website](https://socradar.io/re-examining-the-pyramid-of-pain-to-use-cyber-threat-intelligence-more-effectively/).

By understanding and applying the Pyramid of Pain, cybersecurity professionals can better identify and respond to evolving threats, improving their defense capabilities.

## Hash Values in Cybersecurity

Hash values are numeric representations generated by hashing algorithms to uniquely identify data. They are widely used by security professionals to analyze malicious or suspicious files and reference malware artifacts. Common algorithms include:

- **MD5**: A 128-bit hash function ([RFC 1321](https://www.ietf.org/rfc/rfc1321.txt)). Deprecated due to vulnerabilities, including hash collisions ([RFC 6151](https://datatracker.ietf.org/doc/html/rfc6151)).
- **SHA-1**: A 160-bit hash function ([RFC 3174](https://tools.ietf.org/html/rfc3174)). Deprecated by NIST due to susceptibility to brute-force attacks ([NIST Research](https://csrc.nist.gov/news/2017/research-results-on-sha-1-collisions)).
- **SHA-2**: A stronger alternative, with SHA-256 being the most common variant, producing 256-bit hash values.

### Applications of Hash Values

Hash values help identify and track malicious files in cybersecurity contexts, such as ransomware reports. Security researchers often publish file hashes to aid in threat analysis. Examples of such reports can be found at:
- [The DFIR Report](https://thedfirreport.com/)
- [FireEye Threat Research](https://www.fireeye.com/blog/threat-research.html)

### Tools for Hash Lookups

Online platforms allow quick hash lookups to identify files:
- [VirusTotal](https://www.virustotal.com/gui/)
- [Metadefender Cloud - OPSWAT](https://metadefender.opswat.com/?lang=en)

### VirusTotal:
<img src="/tryhackme/SOC1/Section1/virustotal.png" alt="SOC Responsibility" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />
Below the hash in the screenshot above, you can see the filename. In this case, it is "m_croetian.wnry"

#### MetaDefender Cloud - OPSWAT:
<img src="/tryhackme/SOC1/Section1/opswat.png" alt="SOC Responsibility" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />

As you might have noticed, it is really easy to spot a malicious file if we have the hash in our arsenal.  However, as an attacker, modifying a file by even a single bit is trivial, which would produce a different hash value. With so many variations and instances of known malware or ransomware, threat hunting using file hashes as the IOC (Indicators of Compromise) can become difficult.
Let’s take a look at an example of how you can change the hash value of a file by simply appending a string to the end of a file using echo: File Hash (Before Modification)

```powershell
PS C:\Users\THM\Downloads> Get-FileHash .\OpenVPN_2.5.1_I601_amd64.msi -Algorithm MD5
Algorithm Hash                             Path                                                 
_________ ____                             ____                                                 
MD5       D1A008E3A606F24590A02B853E955CF7 C:\Users\THM\Downloads\OpenVPN_2.5.1_I601_amd64.msi
File Hash (After Modification)
```

```powershell
PS C:\Users\THM\Downloads> echo "AppendTheHash" >> .\OpenVPN_2.5.1_I601_amd64.msi
PS C:\Users\THM\Downloads> Get-FileHash .\OpenVPN_2.5.1_I601_amd64.msi -Algorithm MD5
Algorithm Hash                             Path                                                 
_________ ____                             ____                                                 
MD5       9D52B46F5DE41B73418F8E0DACEC5E9F C:\Users\THM\Downloads\OpenVPN_2.5.1_I601_amd64.msi
```

***Answer the questions below***
- Analyse the report associated with the hash "b8ef959a9176aef07fdca8705254a163b50b49a17217a4ff0107487f59d4a35d" here. What is the filename of the sample?
To answer the above question, we scan the hash value on VirusTotal, we will see the file name right below the hash value 
,as showed below in the picture 

<img src="/tryhackme/SOC1/Section1/hashed.png" alt="file hashed" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />

## IP Addresses and Their Role in the Pyramid of Pain

IP addresses are crucial for identifying devices on a network, from desktops to CCTV cameras. They enable the exchange of information but also serve as an indicator in the **Pyramid of Pain**.

### IP Addresses in the Pyramid of Pain

- Represented in **green** on the pyramid.
- Blocking or denying inbound requests from malicious IPs is a common defense tactic.
- While valuable, blocking IPs is not foolproof, as adversaries can easily change their public IP addresses.
<img src="/tryhackme/SOC1/Section1/ips.png" alt="file hashed" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />

### The Challenge of Fast Flux

**Fast Flux** is a DNS technique used by botnets to enhance their resilience and evade detection. It works by associating multiple IP addresses with a single domain name, constantly rotating them. This complicates detection and mitigation efforts for cybersecurity professionals.

#### Key Resources:
- [Akamai Analysis of Fast Flux](https://blogs.akamai.com/2017/10/digging-deeper-an-in-depth-analysis-of-a-fast-flux-network-part-one.html)
- [Palo Alto's Fast Flux 101](https://unit42.paloaltonetworks.com/fast-flux-101/)

### Tools for Malicious IP Analysis

Platforms like [ANY.RUN](https://any.run/) provide insights into malicious IP connections. **Caution:** Avoid interacting with listed IP addresses to ensure safety.

For further exploration:
- [TryHackMe: What is Networking?](https://tryhackme.com/room/whatisnetworking)
- [Task Report from ANY.RUN](https://assets.tryhackme.com/additional/pyramidofpain/task3-anyrun.pdf)

***Answer the questions below***
- Read the following report to answer this question. What is the first IP address the malicious process (PID 1632) attempts to communicate with?
Scroll Down in the PDF under ```Network Connectivity``` you will the the connections made with their PID, in one of the requests, the answer is there 

- Read the following report to answer this question. What is the first domain name the malicious process ((PID 1632) attempts to communicate with?
Scroll Down under ```DNS requests``` you will see the requests made 

## Domain Names in the Pyramid of Pain

In the **Pyramid of Pain**, domain names are represented by the teal color, indicating a step up in difficulty for attackers compared to changing IP addresses. Domain names map IP addresses to readable text, such as `evilcorp.com` or `tryhackme.evilcorp.com`. For defenders, detecting and blocking malicious domains can disrupt an attacker's operations.

### Domain Name Basics
A domain name can consist of:
- A domain and a top-level domain (e.g., `evilcorp.com`)
- A subdomain, domain, and top-level domain (e.g., `tryhackme.evilcorp.com`)

While changing domain names requires attackers to purchase, register, and update DNS records, many DNS providers have loose standards and APIs, simplifying this process for attackers.

### Punycode Attacks
Attackers exploit **Punycode**, a method of encoding non-ASCII characters into Unicode ASCII, to create malicious domains that appear legitimate. For example:
- Malicious domain: `adıdas.de`
- Punycode: `http://xn--addas-o4a.de`

Browsers like Internet Explorer, Google Chrome, Microsoft Edge, and Safari can now translate Punycode to its full Unicode form, helping users identify deceptive domains. Learn more about [Punycode attacks](https://www.wandera.com/punycode-attacks/).

### URL Shorteners
Malicious actors also use URL shorteners to disguise malicious domains. Commonly exploited services include:
- [bit.ly](https://bit.ly)
- [goo.gl](https://goo.gl)
- [ow.ly](https://ow.ly)
- [tinyurl.com](https://tinyurl.com)

You can view the redirect destination by appending a `+` to the shortened URL (e.g., `https://bit.ly/example+`). For more information, refer to this [Cofense article](https://cofense.com/url-shorteners-fraudsters-friend/).

### Tools for Detection
Defenders use tools like proxy logs and web server logs to uncover malicious domains. For example, the sandboxing service [ANY.RUN](https://any.run/) allows detailed analysis of malware behavior, including domain-related activities.

#### ANY.RUN Features
1. **HTTP Requests**: Tracks all HTTP requests made during the sample's execution, revealing resources accessed by the malware, such as downloaders or callbacks.
2. **Connections**: Displays all communications initiated by the malware, such as C2 traffic or file transfers over FTP.
3. **DNS Requests**: Lists DNS queries made by the malware, often used to check internet connectivity or resolve malicious domains.

### Practical Example
When analyzing malware behavior in ANY.RUN, the "Networking" tab provides visibility into:
- **HTTP requests**: Displays URLs accessed by the malware.
- **Connections**: Shows communication between the malware and external hosts.
- **DNS requests**: Reveals domains queried by the malware for internet connectivity or command and control (C2) operations.

For further learning about DNS and domain name operations, visit the [DNS in Detail](https://tryhackme.com/room/dnsindetail) room.

***Answer the questions below***

1. Go to this report on [app.any.run](https://app.any.run/tasks/a66178de-7596-4a05-945d-704dbf6b3b90) and provide the first suspicious domain request you are seeing. You will use this report to answer the remaining questions of this task.
- Open the report right below and click on DNS requests, it wll show This
<img src="/tryhackme/SOC1/Section1/dns.png" alt="dns connections" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />
2. What term refers to an address used to access websites?
- something that starts with ***Domain xxxx***
3. What type of attack uses Unicode characters in the domain name to imitate the a known domain?
- ***Punycode xxx***
4. Provide the redirected website for the shortened URL using a preview: [open me](https://tinyurl.com/bw7t8p4u)
- To answer this question, click on `open me` it will redirect you to `tryhackme`

## Host Artifacts (Annoying)
Let's take another step up to the yellow zone.

On this level, the attacker will feel a little more annoyed and frustrated if you can detect the attack. The attacker would need to circle back at this detection level and change his attack tools and methodologies. This is very time-consuming for the attacker, and probably, he will need to spend more resources on his adversary tools.

Host artifacts are the traces or observables that attackers leave on the system, such as registry values, suspicious process execution, attack patterns or IOCs (Indicators of Compromise), files dropped by malicious applications, or anything exclusive to the current threat.

### Suspicious process execution from Word: 
<img src="/tryhackme/SOC1/Section1/sodinokibi.png" alt="" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />

### The files modified/dropped by the malicious actor:
<img src="/tryhackme/SOC1/Section1/dropped-actor.png" alt="" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />

***Answer the questions below***

1. A process named regidle.exe makes a POST request to an IP address based in the United States (US) on port 8080. What is the IP address?
- Using this [Report](https://assets.tryhackme.com/additional/pyramidofpain/task5-report.pdf) scroll down to `Network Activity` the answer is in the second ROW i.e `96.126.XX.XX`


2. The actor drops a malicious executable (EXE). What is the name of this executable?
The question si tricky, i take a look at at the Hint which says ***This can be found mid-way through page39 of the report***
- Answer: G_ju***

2. Look at this [report](https://assets.tryhackme.com/additional/pyramidofpain/vtotal2.png) by Virustotal. How many vendors determine this host to be malicious?
- Counts how many number of RED lines are there 

## Network Artifacts (Annoying)

Network artifacts belong to the **yellow zone** in the Pyramid of Pain. Detecting and responding to these artifacts makes it harder for attackers to modify their tactics or tools, providing defenders more time to respond and remediate existing or upcoming threats.

### What Are Network Artifacts?

A network artifact can include:
- **User-Agent strings**: Uncommon or unrecognized user-agent strings originating from the attacker.
- **Command and Control (C2) information**: Details related to the attacker’s infrastructure.
- **URI patterns in HTTP POST requests**: Specific patterns that may indicate malicious activity.

#### User-Agent Strings
Defined by **RFC2616**, the `User-Agent` request-header field contains information about the client originating the request. Attackers may use unconventional or unfamiliar user-agent strings to evade detection.

### Detecting Network Artifacts

- HTTP POST requests containing suspicious strings:
<img src="/tryhackme/SOC1/Section1/strings.png" alt="" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />

Network artifacts can be detected using:

1. **Wireshark PCAPs**  
   Analyze packet data files using Wireshark or TShark to identify unusual patterns.

2. **Intrusion Detection Systems (IDS)**  
   Tools like **Snort** can log network traffic and identify artifacts indicative of malicious activity.
Let's use TShark to filter out the User-Agent strings by using the following command: ```tshark --Y http.request -T fields -e http.host -e http.user_agent -r analysis_file.pcap``
<img src="/tryhackme/SOC1/Section1/traffic.png" alt="" height="450" width="600" style="display: block; margin-left: auto; margin-right: auto;" />

***Answer the questions below****
1. What browser uses the User-Agent string shown in the screenshot above?
- Answer: Internet ***

